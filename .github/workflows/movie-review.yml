name: Weekly Movie & TV Review

on:
  schedule:
    # Saturday 11:00 AM IST = Friday 12:30 PM PST (5:30 UTC)
    - cron: '30 5 * * 6'  # Every Saturday 4:30 UTC
  workflow_dispatch:  # Manual trigger button

jobs:
  generate-reviews:
    runs-on: ubuntu-latest
    timeout-minutes: 15
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          pip install requests beautifulsoup4 cloudscraper groq python-dotenv apscheduler pandas openpyxl
      
      - name: Run movie review pipeline
        env:
          GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
          GROQ_MODEL: ${{ secrets.GROQ_MODEL }}
          HN_PUBLICATION_ID: ${{ secrets.HN_PUBLICATION_ID }}
          HN_ACCESS_TOKEN: ${{ secrets.HN_ACCESS_TOKEN }}
        run: |
          python -c "from src.crew_lite import run_movie_review_pipeline; run_movie_review_pipeline()"
      
      - name: Notify on failure
        if: failure()
        run: echo "Pipeline failed! Check logs at https://github.com/${{ github.repository }}/actions"
